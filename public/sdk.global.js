"use strict";(()=>{var n=class{queue=[];url="";debug=!1;STORAGE_KEY="corona_analytics_queue";constructor(){this._recoverFromStorage()}init(e){this.url=e.url,this.debug=e.debug||!1,this.debug&&console.log("CoronaAnalytics: Initialized"),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.flush()})}log(e,t={}){let s={event:e,time:Date.now(),...t};this.queue.push(s),this._saveToStorage(),this.debug&&console.log(`Logged: ${e}`,s)}flush(){if(!this.url||this.queue.length===0)return;let e=JSON.stringify(this.queue),t=new Blob([e],{type:"application/json"});navigator.sendBeacon(this.url,t)?(this.debug&&console.log("Flushed via Beacon"),this.queue=[],this._saveToStorage()):fetch(this.url,{method:"POST",body:e,headers:{"Content-Type":"application/json"},keepalive:!0}).then(()=>{this.debug&&console.log("Flushed via Fetch"),this.queue=[],this._saveToStorage()}).catch(o=>console.error("Analytics flush failed",o))}processQueue(e){this.debug&&console.log(`Processing ${e.length} queued commands...`),e.forEach(t=>{let s=Array.from(t),o=s[0],r=s.slice(1);typeof this[o]=="function"&&this[o](...r)})}_saveToStorage(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.queue))}catch{}}_recoverFromStorage(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(e){let t=JSON.parse(e);Array.isArray(t)&&(this.queue=[...t,...this.queue],this.debug&&t.length>0&&console.log(`Recovered ${t.length} events from storage.`))}}catch(e){console.error("Failed to recover analytics",e)}}},i=window.CoronaAnalytics,a=new n;window.CoronaAnalytics=a;i&&Array.isArray(i.q)&&a.processQueue(i.q);})();
