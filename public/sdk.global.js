"use strict";(()=>{var o=class{queue=[];url="";debug=!1;STORAGE_KEY="corona_analytics_queue";constructor(){this._recoverFromStorage()}init(e){this.url=e.url,this.debug=e.debug||!1,this.debug&&console.log("CoronaAnalytics: Initialized"),this._processLoaderQueue(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.flush()})}log(e,t={}){if(!this.url){console.warn("CoronaAnalytics: No URL set. Call init() first.");return}let s={event:e,time:Date.now(),...t};this.queue.push(s),this._saveToStorage(),this.debug&&console.log(`Logged: ${e}`,s)}flush(){if(!this.url||this.queue.length===0)return;let e=JSON.stringify(this.queue),t=new Blob([e],{type:"application/json"});navigator.sendBeacon(this.url,t)?(this.debug&&console.log("Flushed via Beacon"),this.queue=[],this._saveToStorage()):fetch(this.url,{method:"POST",body:e,headers:{"Content-Type":"application/json"},keepalive:!0}).then(()=>{this.debug&&console.log("Flushed via Fetch"),this.queue=[],this._saveToStorage()}).catch(i=>console.error("Analytics flush failed",i))}_saveToStorage(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.queue))}catch{}}_recoverFromStorage(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(e){let t=JSON.parse(e);Array.isArray(t)&&(this.queue=[...t,...this.queue],this.debug&&t.length>0&&console.log(`Recovered ${t.length} events from storage.`))}}catch(e){console.error("Failed to recover analytics",e)}}_processLoaderQueue(){let e=window.CoronaAnalytics;e&&Array.isArray(e.q)&&(this.debug&&console.log(`Processing ${e.q.length} queued commands...`),e.q.forEach(t=>{let s=t[0],i=t.slice(1);typeof this[s]=="function"&&this[s](...i)}))}};window.CoronaAnalytics=new o;})();
